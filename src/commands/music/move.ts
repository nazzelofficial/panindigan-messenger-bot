import type { Command, CommandContext } from '../../types/index.js';
import musicService from '../../services/musicService.js';

export const command: Command = {
  name: 'move',
  aliases: ['mv', 'reorder'],
  description: 'Move a song to a different position in queue',
  category: 'music',
  usage: 'move <from> <to>',
  examples: ['move 3 1', 'mv 5 2'],
  cooldown: 2000,

  async execute({ event, args, reply, prefix }: CommandContext): Promise<void> {
    const threadId = event.threadID;
    const session = musicService.getSession(threadId);

    if (args.length < 2) {
      await reply(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ     ğŸ“ ğ— ğ—¢ğ—©ğ—˜ ğ—¦ğ—¢ğ—¡ğ—š ğŸ“     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â”Œâ”€â”€ ğŸ“– ğ—¨ğ˜€ğ—®ğ—´ğ—² â”€â”€â”
â”‚ ${prefix}move <from> <to>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€ ğŸ’¡ ğ—˜ğ˜…ğ—®ğ—ºğ—½ğ—¹ğ—²ğ˜€ â”€â”€â”
â”‚ ${prefix}move 3 1  (move #3 to #1)
â”‚ ${prefix}move 5 2  (move #5 to #2)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ ${prefix}queue to see positions`);
      return;
    }

    const from = parseInt(args[0]);
    const to = parseInt(args[1]);

    if (isNaN(from) || isNaN(to) || from < 1 || to < 1) {
      await reply(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ     âš ï¸ ğ—œğ—¡ğ—©ğ—”ğ—Ÿğ—œğ—— âš ï¸     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

âŒ Please provide valid position numbers.

ğŸ’¡ Use ${prefix}queue to see song positions`);
      return;
    }

    if (session.queue.length < 2) {
      await reply(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ     âš ï¸ ğ—–ğ—”ğ—¡'ğ—§ ğ— ğ—¢ğ—©ğ—˜ âš ï¸     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

âŒ Need at least 2 songs in queue to move.

â”Œâ”€â”€ ğŸ“Š ğ—¤ğ˜‚ğ—²ğ˜‚ğ—² â”€â”€â”
â”‚ ğŸµ ${session.queue.length} song(s)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ ${prefix}play <song> to add more music`);
      return;
    }

    const trackToMove = session.queue[from - 1];
    const success = musicService.moveInQueue(threadId, from, to);

    if (!success) {
      await reply(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ     âš ï¸ ğ—œğ—¡ğ—©ğ—”ğ—Ÿğ—œğ—— ğ—£ğ—¢ğ—¦ğ—œğ—§ğ—œğ—¢ğ—¡ âš ï¸     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

âŒ Invalid position(s): ${from} â†’ ${to}

â”Œâ”€â”€ ğŸ“Š ğ—¤ğ˜‚ğ—²ğ˜‚ğ—² ğ—œğ—»ğ—³ğ—¼ â”€â”€â”
â”‚ ğŸµ ${session.queue.length} songs in queue
â”‚ ğŸ“ Valid positions: 1-${session.queue.length}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ ${prefix}queue to see all positions`);
      return;
    }

    await reply(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ     ğŸ“ ğ— ğ—¢ğ—©ğ—˜ğ—— ğŸ“     â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

âœ… Song moved successfully!

â”Œâ”€â”€ ğŸµ ğ—§ğ—¿ğ—®ğ—°ğ—¸ â”€â”€â”
â”‚ ğŸ¶ ${trackToMove.title}
â”‚ ğŸ“ Position: #${from} â†’ #${to}
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¡ ${prefix}queue to view updated queue`);
  }
};
